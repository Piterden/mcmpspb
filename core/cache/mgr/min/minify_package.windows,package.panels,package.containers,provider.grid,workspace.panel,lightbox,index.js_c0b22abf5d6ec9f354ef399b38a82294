MODx.window.PackageUninstall=function(config){config=config||{};Ext.applyIf(config,{title:_('package_uninstall'),url:MODx.config.connector_url,action:'workspace/packages/uninstall',id:'modx-window-package-uninstall',saveBtnText:_('uninstall'),fields:[{html:_('preexisting_mode_select'),cls:'win-desc panel-desc'},{xtype:'radio',name:'preexisting_mode',fieldLabel:_('preexisting_mode_preserve'),boxLabel:_('preexisting_mode_preserve_desc'),inputValue:0,checked:true},{xtype:'radio',name:'preexisting_mode',fieldLabel:_('preexisting_mode_remove'),boxLabel:_('preexisting_mode_remove_desc'),inputValue:1},{xtype:'radio',name:'preexisting_mode',fieldLabel:_('preexisting_mode_restore'),boxLabel:_('preexisting_mode_restore_desc'),inputValue:2}]});MODx.window.PackageUninstall.superclass.constructor.call(this,config);};Ext.extend(MODx.window.PackageUninstall,MODx.Window,{submit:function(){var va=this.fp.getForm().getValues();this.fireEvent('success',va);this.hide();}});Ext.reg('modx-window-package-uninstall',MODx.window.PackageUninstall);MODx.window.RemovePackage=function(config){config=config||{};Ext.applyIf(config,{title:_('package_remove'),url:MODx.config.connector_url,baseParams:{action:'workspace/packages/uninstall'},defaults:{border:false},fields:[{xtype:'hidden',name:'signature',id:'modx-rpack-signature',value:config.signature},{html:_('package_remove_confirm')},MODx.PanelSpacer,{html:_('package_remove_force_desc'),border:false},{xtype:'xcheckbox',name:'force',boxLabel:_('package_remove_force'),hideLabel:true,id:'modx-rpack-force',labelSeparator:'',inputValue:'true'}],saveBtnText:_('package_remove')});MODx.window.RemovePackage.superclass.constructor.call(this,config);};Ext.extend(MODx.window.RemovePackage,MODx.Window,{submit:function(){var r=this.config.record;if(this.fp.getForm().isValid()){Ext.getCmp('modx-package-grid').loadConsole(Ext.getBody(),r.topic);this.fp.getForm().baseParams={action:'workspace/packages/remove',signature:r.signature,register:'mgr',topic:r.topic,force:Ext.getCmp('modx-rpack-force').getValue()};this.fp.getForm().submit({waitMsg:_('saving'),scope:this,failure:function(frm,a){this.fireEvent('failure',frm,a);var g=Ext.getCmp('modx-package-grid');g.getConsole().fireEvent('complete');g.refresh();Ext.Msg.hide();this.hide();},success:function(frm,a){this.fireEvent('success',{f:frm,a:a});var g=Ext.getCmp('modx-package-grid');g.getConsole().fireEvent('complete');g.refresh();Ext.Msg.hide();this.hide();}});}}});Ext.reg('modx-window-package-remove',MODx.window.RemovePackage);MODx.window.SetupOptions=function(config){config=config||{};Ext.applyIf(config,{title:_('setup_options'),layout:'form',items:[{xtype:'modx-template-panel',id:'modx-setupoptions-panel',bodyCssClass:'win-desc panel-desc',startingMarkup:'<tpl for="."><p>{text}</p></tpl>',startingText:_('setup_options_desc')},{html:'',xtype:'form',bodyCssClass:'inline-form',id:'modx-setupoptions-form'}],buttons:[{text:config.cancelBtnText||_('cancel'),scope:this,handler:function(){this.hide();}},{text:_('package_install'),cls:'primary-button',id:'package-setupoptions-install-btn',handler:this.install,scope:this}]});MODx.window.SetupOptions.superclass.constructor.call(this,config);};Ext.extend(MODx.window.SetupOptions,MODx.Window,{fetch:function(content){Ext.getCmp('modx-setupoptions-form').getForm().getEl().update(content);},install:function(btn,ev){this.hide();var options=Ext.getCmp('modx-setupoptions-form').getForm().getValues();Ext.getCmp('modx-panel-packages').install(options);}});Ext.reg('modx-package-setupoptions',MODx.window.SetupOptions);MODx.window.ChangeProvider=function(config){config=config||{};Ext.applyIf(config,{title:_('provider_select'),width:600,layout:'form',items:[{xtype:'modx-template-panel',id:'modx-cp-panel',bodyCssClass:'win-desc panel-desc',startingMarkup:'<tpl for="."><p>{text}</p></tpl>',startingText:_('provider_select_desc')},{xtype:'form',id:'change-provider-form',border:false,items:[{fieldLabel:_('provider'),xtype:'modx-combo-provider',id:'modx-pdselprov-provider',anchor:'100%',allowBlank:false,baseParams:{action:'workspace/providers/getList',showNone:false}}]}],buttons:[{text:config.cancelBtnText||_('cancel'),scope:this,handler:function(){this.hide();}},{text:_('save_and_go_to_browser'),cls:'primary-button',id:'package-cp-btn',handler:this.submit,scope:this}]});MODx.window.ChangeProvider.superclass.constructor.call(this,config);};Ext.extend(MODx.window.ChangeProvider,Ext.Window,{submit:function(o){var fm=Ext.getCmp('change-provider-form');if(fm.getForm().isValid()){var vs=fm.getForm().getValues();MODx.provider=vs.provider;MODx.providerName=fm.getForm().findField('provider').getRawValue();var tree=Ext.getCmp('modx-package-browser-tree');tree.setProvider(vs.provider);if(tree.rendered){var loader=tree.getLoader();loader.baseParams={action:'workspace/packages/rest/getNodes',provider:vs.provider};loader.load(tree.root);}
MODx.debug('Switching to: '+MODx.provider);this.hide();Ext.getCmp('modx-panel-packages-browser').activate();}}});Ext.reg('modx-package-changeprovider',MODx.window.ChangeProvider);;MODx.panel.PackageMetaPanel=function(config){config=config||{};Ext.applyIf(config,{cls:'vertical-tabs-panel wrapped',items:[]});MODx.panel.PackageMetaPanel.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.PackageMetaPanel,MODx.VerticalTabs,{updatePanel:function(meta){if(meta.changelog!=undefined){this.addTab(_('changelog'),'changelog',meta);}
if(meta.readme!=undefined){this.addTab(_('readme'),'readme',meta);}
if(meta.license!=undefined){this.addTab(_('license'),'license',meta);}
this.setActiveTab(0);Ext.getCmp('modx-content').doLayout();},addTab:function(title,id,data){var tab=this.getItem(id);if(!tab){this.add({title:title,xtype:'modx-template-panel',id:id+'-tab',markup:'{'+id+'}',bodyCssClass:'meta-wrapper',listeners:{afterrender:function(){this.updateDetail(data);}}});}else{tab.updateDetail(data);}}});Ext.reg('modx-package-meta-panel',MODx.panel.PackageMetaPanel);MODx.panel.PackageBeforeInstall=function(config){config=config||{};this.currentCrumbText=_('install');this.setupOptions=null;Ext.applyIf(config,{});MODx.panel.PackageBeforeInstall.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.PackageBeforeInstall,MODx.panel.PackageMetaPanel,{activate:function(){Ext.getCmp(this.ownerCt.id).getLayout().setActiveItem(this.id);this.removeAll();},updateBreadcrumbs:function(msg){var bd={text:msg};bd.trail=[{text:this.currentCrumbText}];Ext.getCmp('packages-breadcrumbs').updateDetail(bd);},updatePanel:function(meta){this.updateBreadcrumbs(_('license_agreement_desc'));Ext.getCmp('package-list-reset').show();Ext.getCmp('package-install-btn').hide();Ext.getCmp('package-show-setupoptions-btn').hide();if(meta.changelog!=undefined){this.addTab(_('changelog'),'changelog',meta);}
if(meta.readme!=undefined){this.addTab(_('readme'),'readme',meta);}
if(meta.license!=undefined){this.addTab(_('license'),'license',meta);}
if(meta['setup-options']!=null&&meta['setup-options']!=''){Ext.getCmp('package-show-setupoptions-btn').show();this.setupOptions=meta['setup-options'];}else{Ext.getCmp('package-install-btn').show();}
this.setActiveTab(0);Ext.getCmp('modx-content').doLayout();},getOptions:function(){return this.setupOptions;}});Ext.reg('modx-package-beforeinstall',MODx.panel.PackageBeforeInstall);MODx.panel.PackageDetails=function(config){config=config||{};Ext.applyIf(config,{layout:'column',border:false,autoHeight:true,items:[{xtype:'modx-template-panel',id:'modx-package-details-metas',columnWidth:1,markup:'<div class="details">'
+'<tpl for=".">'
+'<tpl if="readme">'
+'<div class="item">'
+'<h4>'+_('readme')+'</h4>'
+'{readme}'
+'</div>'
+'</tpl>'
+'<tpl if="changelog">'
+'<div class="item">'
+'<h4>'+_('changelog')+'</h4>'
+'{changelog}'
+'</div>'
+'</tpl>'
+'<tpl if="license">'
+'<div class="item">'
+'<h4>'+_('license')+'</h4>'
+'{license}'
+'</div>'
+'</tpl>'
+'</tpl>'
+'</div>'},{xtype:'modx-template-panel',id:'modx-package-details-aside',cls:'aside-details',width:250,markup:'<div class="details">'
+'<tpl for=".">'
+'<div class="selected">'
+'<h5>{package_name}</h5>'
+'</div>'
+'<div class="infos description">'
+'<h4>'+_('information')+'</h4>'
+'<ul>'
+'<li>'
+'<span class="infoname">'+_('signature')+':</span>'
+'<span class="infovalue">{signature}</span>'
+'</li>'
+'<li>'
+'<span class="infoname">'+_('uploaded_on')+':</span>'
+'<span class="infovalue">{created}</span>'
+'</li>'
+'<li>'
+'<span class="infoname">'+_('installed')+':</span>'
+'<span class="infovalue">{installed}</span>'
+'</li>'
+'<li>'
+'<span class="infoname">'+_('last_updated')+':</span>'
+'<span class="infovalue">{updated}</span>'
+'</li>'
+'<li>'
+'<span class="infoname">'+_('provider')+':</span>'
+'<span class="infovalue">{provider}</span>'
+'</li>'
+'</ul>'
+'</div>'
+'</tpl>'
+'</div>'}]});MODx.panel.PackageDetails.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.PackageDetails,MODx.Panel,{activate:function(){Ext.getCmp(this.ownerCt.id).getLayout().setActiveItem(this.id);},updateBreadcrumbs:function(msg){Ext.getCmp('packages-breadcrumbs').updateDetail({text:msg,trail:[{text:_('package_details')}]});},updateDetail:function(rec){this.updateBreadcrumbs(_('package_details_for',{'package':rec.package_name}));Ext.getCmp('modx-package-details-metas').updateDetail(rec);Ext.getCmp('modx-package-details-aside').updateDetail(rec);}});Ext.reg('modx-package-details',MODx.panel.PackageDetails);;MODx.panel.Packages=function(config){config=config||{};Ext.applyIf(config,{layout:'card',border:false,layoutConfig:{deferredRender:true},defaults:{autoHeight:true,autoWidth:true,border:false},activeItem:0,items:[{xtype:'modx-package-grid',id:'modx-package-grid',bodyCssClass:'grid-with-buttons'},{xtype:'modx-package-beforeinstall',id:'modx-package-beforeinstall'},{xtype:'modx-package-details',id:'modx-package-details',bodyCssClass:'modx-template-detail'}],buttons:[{text:_('cancel'),id:'package-list-reset',hidden:true,handler:function(btn,e){Ext.getCmp('modx-panel-packages').activate();},scope:this},{text:_('continue'),id:'package-install-btn',cls:'primary-button',hidden:true,handler:this.install,scope:this},{text:_('setup_options'),id:'package-show-setupoptions-btn',cls:'primary-button',hidden:true,handler:this.onSetupOptions,scope:this}]});MODx.panel.Packages.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.Packages,MODx.Panel,{activate:function(){Ext.getCmp('card-container').getLayout().setActiveItem(this.id);Ext.getCmp('modx-package-grid').activate();Ext.each(this.buttons,function(btn){Ext.getCmp(btn.id).hide();});},install:function(va){var g=Ext.getCmp('modx-package-grid');if(!g)return false;var r=g.menu.record.data?g.menu.record.data:g.menu.record;var topic='/workspace/package/install/'+r.signature+'/';g.loadConsole(Ext.getBody(),topic);va=va||{};Ext.apply(va,{action:'workspace/packages/install',signature:r.signature,register:'mgr',topic:topic});MODx.Ajax.request({url:MODx.config.connector_url,params:va,listeners:{'success':{fn:function(){this.activate();Ext.getCmp('modx-package-grid').refresh();},scope:this},'failure':{fn:function(){this.activate();},scope:this}}});},onSetupOptions:function(btn){if(this.win==undefined){this.win=new MODx.window.SetupOptions({id:'modx-window-setupoptions'});}
this.win.show(btn);var opts=Ext.getCmp('modx-package-beforeinstall').getOptions();this.win.fetch(opts);}});Ext.reg('modx-panel-packages',MODx.panel.Packages);MODx.panel.PackagesBrowser=function(config){config=config||{};Ext.applyIf(config,{layout:'column',border:false,items:[{xtype:'modx-package-browser-tree',id:'modx-package-browser-tree',width:250},{layout:'card',columnWidth:1,defaults:{border:false},border:false,id:'package-browser-card-container',layoutConfig:{deferredRender:true},items:[{xtype:'modx-package-browser-home',id:'modx-package-browser-home'},{xtype:'modx-package-browser-repositories',id:'modx-package-browser-repositories'},{xtype:'modx-package-browser-grid',id:'modx-package-browser-grid',bodyCssClass:'grid-with-buttons'},{xtype:'modx-package-browser-details',id:'modx-package-browser-details',bodyCssClass:'modx-template-detail'},{xtype:'modx-package-browser-view',id:'modx-package-browser-view',bodyCssClass:'modx-template-detail'}]}]});MODx.panel.PackagesBrowser.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.PackagesBrowser,MODx.Panel,{activate:function(){Ext.getCmp('modx-layout').hideLeftbar(true,false);Ext.getCmp('card-container').getLayout().setActiveItem(this.id);Ext.getCmp('modx-package-browser-home').activate();this.updateBreadcrumbs(_('provider_home_msg'));},updateBreadcrumbs:function(msg,highlight){var bd={text:msg};if(highlight){bd.className='highlight';}
bd.trail=[{text:_('package_browser')}];Ext.getCmp('packages-breadcrumbs').updateDetail(bd);},showWait:function(){if(typeof(this.wait)=="undefined"){this.wait=new MODx.PackageBrowserWaitWindow();}
this.wait.show();},hideWait:function(){this.wait.hide();}});Ext.reg('modx-panel-packages-browser',MODx.panel.PackagesBrowser);;MODx.grid.Provider=function(config){config=config||{};Ext.applyIf(config,{title:_('providers'),url:MODx.config.connector_url,save_action:'workspace/providers/updatefromgrid',baseParams:{action:'workspace/providers/getlist'},fields:['id','name','description','service_url','username','api_key','menu'],paging:true,autosave:true,columns:[{header:_('name'),dataIndex:'name',editor:{xtype:'textfield',allowBlank:false}},{header:_('service_url'),dataIndex:'service_url',width:200,editor:{xtype:'textfield',allowBlank:false}},{header:_('description'),dataIndex:'description',width:300,editor:{xtype:'textarea'}}],tbar:[{text:_('provider_add'),cls:'primary-button',handler:{xtype:'modx-window-provider-create',blankValues:true}}]});MODx.grid.Provider.superclass.constructor.call(this,config);};Ext.extend(MODx.grid.Provider,MODx.grid.Grid);Ext.reg('modx-grid-provider',MODx.grid.Provider);MODx.window.CreateProvider=function(config){config=config||{};Ext.applyIf(config,{title:_('provider_add'),url:MODx.config.connector_url,action:'workspace/providers/create',fields:[{name:'id',xtype:'hidden'},{fieldLabel:_('name'),name:'name',xtype:'textfield',anchor:'100%',allowBlank:false},{fieldLabel:_('service_url'),name:'service_url',xtype:'textfield',anchor:'100%',allowBlank:false},{fieldLabel:_('username'),name:'username',xtype:'textfield',anchor:'100%'},{fieldLabel:_('api_key'),name:'api_key',xtype:'textfield',anchor:'100%'},{fieldLabel:_('description'),name:'description',xtype:'textarea',anchor:'100%',grow:true}]});MODx.window.CreateProvider.superclass.constructor.call(this,config);};Ext.extend(MODx.window.CreateProvider,MODx.Window);Ext.reg('modx-window-provider-create',MODx.window.CreateProvider);MODx.window.UpdateProvider=function(config){config=config||{};Ext.applyIf(config,{title:_('provider_update'),action:'workspace/providers/update'});MODx.window.UpdateProvider.superclass.constructor.call(this,config);};Ext.extend(MODx.window.UpdateProvider,MODx.window.CreateProvider);Ext.reg('modx-window-provider-update',MODx.window.UpdateProvider);;MODx.panel.Workspace=function(config){config=config||{};Ext.applyIf(config,{id:'modx-panel-workspace',cls:'container',bodyStyle:'',unstyled:true,items:this.getItems(config)});MODx.panel.Workspace.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.Workspace,MODx.Panel,{getItems:function(config){var i=[{html:'<h2>'+_('package_management')+'</h2>',border:false,cls:'modx-page-header',id:'modx-workspace-header'}];if(MODx.errors.length>0){var errors=[];Ext.each(MODx.errors,function(error){errors.push('<p>'+error+'</p>')});errors.join('<hr>');i.push([{html:'<h3>'+_('warning')+'</h3>'+errors,cls:'modx-page-header'}]);}
i.push([MODx.getPageStructure([{title:_('packages'),items:[{xtype:'modx-breadcrumbs-panel',id:'packages-breadcrumbs',desc:_('packages_desc'),root:{text:'Packages List',className:'first',root:true,pnl:'modx-panel-packages'}},{layout:'card',id:'card-container',activeItem:0,border:false,autoHeight:true,defaults:{cls:'main-wrapper',preventRender:true,autoHeight:true},items:[{xtype:'modx-panel-packages',id:'modx-panel-packages'},{xtype:'modx-panel-packages-browser',id:'modx-panel-packages-browser'}]}]},{title:_('providers'),autoHeight:true,layout:'form',items:[{html:'<p>'+_('providers_desc')+'</p>',bodyCssClass:'panel-desc',border:false},{xtype:'modx-grid-provider',id:'modx-grid-provider',cls:'main-wrapper',title:'',preventRender:true}]}])]);return i;}});Ext.reg('modx-panel-workspace',MODx.panel.Workspace);;Ext.ns('Ext.ux');Ext.ux.Lightbox=(function(){var els={},images=[],activeImage,initialized=false,selectors=[];return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?((11-this.resizeSpeed)*0.15):0;this.overlayDuration=this.animate?0.2:0;if(!initialized){Ext.apply(this,Ext.util.Observable.prototype);Ext.util.Observable.constructor.call(this);this.addEvents('open','close');this.initMarkup();this.initEvents();initialized=true;}},initMarkup:function(){els.shim=Ext.DomHelper.append(document.body,{tag:'iframe',id:'ux-lightbox-shim'},true);els.overlay=Ext.DomHelper.append(document.body,{id:'ux-lightbox-overlay'},true);var lightboxTpl=new Ext.Template(this.getTemplate());els.lightbox=lightboxTpl.append(document.body,{},true);var ids=['outerImageContainer','imageContainer','image','hoverNav','navPrev','navNext','loading','loadingLink','outerDataContainer','dataContainer','data','details','caption','imageNumber','bottomNav','navClose'];Ext.each(ids,function(id){els[id]=Ext.get('ux-lightbox-'+id);});Ext.each([els.overlay,els.lightbox,els.shim],function(el){el.setVisibilityMode(Ext.Element.DISPLAY)
el.hide();});var size=(this.animate?250:1)+'px';els.outerImageContainer.setStyle({width:size,height:size});},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>','</div>','<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>','</div>','</div>','</div>','<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>','</div>','<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>','</div>','</div>','</div>','</div>','</div>'];},initEvents:function(){var close=function(ev){ev.preventDefault();this.close();};els.overlay.on('click',close,this);els.loadingLink.on('click',close,this);els.navClose.on('click',close,this);els.lightbox.on('click',function(ev){if(ev.getTarget().id=='ux-lightbox'){this.close();}},this);els.navPrev.on('click',function(ev){ev.preventDefault();this.setImage(activeImage-1);},this);els.navNext.on('click',function(ev){ev.preventDefault();this.setImage(activeImage+1);},this);},register:function(sel,group){if(selectors.indexOf(sel)===-1){selectors.push(sel);Ext.fly(document).on('click',function(ev){var target=ev.getTarget(sel);if(target){ev.preventDefault();this.open(target,sel,group);}},this);}},open:function(image,sel,group){group=group||false;this.setViewSize();els.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){images=[];var index=0;if(!group){images.push([image.href,image.title]);}
else{var setItems=Ext.query(sel);Ext.each(setItems,function(item){if(item.href){images.push([item.href,item.title]);}});while(images[index][0]!=image.href){index++;}}
var pageScroll=Ext.fly(document).getScroll();var lightboxTop=pageScroll.top+(Ext.lib.Dom.getViewportHeight()/10);var lightboxLeft=pageScroll.left;els.lightbox.setStyle({top:lightboxTop+'px',left:lightboxLeft+'px'}).show();this.setImage(index);this.fireEvent('open',images[index]);},scope:this});},setViewSize:function(){var viewSize=this.getViewSize();els.overlay.setStyle({width:viewSize[0]+'px',height:viewSize[1]+'px'});els.shim.setStyle({width:viewSize[0]+'px',height:viewSize[1]+'px'}).show();},setImage:function(index){activeImage=index;this.disableKeyNav();if(this.animate){els.loading.show();}
els.image.hide();els.hoverNav.hide();els.navPrev.hide();els.navNext.hide();els.dataContainer.setOpacity(0.0001);els.imageNumber.hide();var preload=new Image();preload.onload=(function(){var viewSize=Ext.getBody().getViewSize();var dim=this.scaleSize(viewSize.width,viewSize.height,preload.width,preload.height);els.image.setWidth(dim[0]);els.image.setHeight(dim[1]);els.image.dom.src=images[activeImage][0];this.resizeImage(els.image.dom.width,els.image.dom.height);}).createDelegate(this);preload.src=images[activeImage][0];},scaleSize:function(maxWidth,maxHeight,width,height){var ratio=0;maxHeight=maxHeight-200;if(width>maxWidth){ratio=maxWidth/width;width=maxWidth;height=height*ratio;}
if(height>(maxHeight)){ratio=maxHeight/height;width=width*ratio;height=maxHeight;}
return[width,height];},resizeImage:function(w,h){var wCur=els.outerImageContainer.getWidth();var hCur=els.outerImageContainer.getHeight();var wNew=(w+this.borderSize*2);var hNew=(h+this.borderSize*2);var wDiff=wCur-wNew;var hDiff=hCur-hNew;var afterResize=function(){els.hoverNav.setWidth(els.imageContainer.getWidth()+'px');els.navPrev.setHeight(h+'px');els.navNext.setHeight(h+'px');els.outerDataContainer.setWidth(wNew+'px');this.showImage();};if(hDiff!=0||wDiff!=0){els.outerImageContainer.shift({height:hNew,width:wNew,duration:this.resizeDuration,scope:this,callback:afterResize,delay:50});}
else{afterResize.call(this);}},showImage:function(){els.loading.hide();els.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails();}});this.preloadImages();},updateDetails:function(){var detailsWidth=els.data.getWidth(true)-els.navClose.getWidth()-10;els.details.setWidth((detailsWidth>0?detailsWidth:0)+'px');els.caption.update(images[activeImage][1]);els.caption.show();if(images.length>1){els.imageNumber.update(this.labelImage+' '+(activeImage+1)+' '+this.labelOf+'  '+images.length);els.imageNumber.show();}
els.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var viewSize=this.getViewSize();els.overlay.setHeight(viewSize[1]+'px');this.updateNav();}});},updateNav:function(){this.enableKeyNav();els.hoverNav.show();if(activeImage>0)
els.navPrev.show();if(activeImage<(images.length-1))
els.navNext.show();},enableKeyNav:function(){Ext.fly(document).on('keydown',this.keyNavAction,this);},disableKeyNav:function(){Ext.fly(document).un('keydown',this.keyNavAction,this);},keyNavAction:function(ev){var keyCode=ev.getKey();if(keyCode==88||keyCode==67||keyCode==27){this.close();}
else if(keyCode==80||keyCode==37){if(activeImage!=0){this.setImage(activeImage-1);}}
else if(keyCode==78||keyCode==39){if(activeImage!=(images.length-1)){this.setImage(activeImage+1);}}},preloadImages:function(){var next,prev;if(images.length>activeImage+1){next=new Image();next.src=images[activeImage+1][0];}
if(activeImage>0){prev=new Image();prev.src=images[activeImage-1][0];}},close:function(){this.disableKeyNav();els.lightbox.hide();els.overlay.fadeOut({duration:this.overlayDuration});els.shim.hide();this.fireEvent('close',activeImage);},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()];}}})();Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);;MODx.page.Workspace=function(config){config=config||{};Ext.applyIf(config,{components:[{xtype:'modx-panel-workspace'}],buttons:[{text:_('help_ex'),handler:MODx.loadHelpPane}]});MODx.page.Workspace.superclass.constructor.call(this,config);Ext.Ajax.timeout=0;};Ext.extend(MODx.page.Workspace,MODx.Component);Ext.reg('modx-page-workspace',MODx.page.Workspace);